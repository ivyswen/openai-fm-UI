# 项目开发经验记录

## 状态管理经验

1. **音频实例管理**
   - 使用 `useState` 管理音频实例，确保在切换语音时正确清理旧实例
   - 在组件卸载时记得清理音频资源
   - 使用自定义类型 `CustomAudioElement` 扩展 `HTMLAudioElement`，便于类型检查

2. **全局状态设计**
   - 将状态分类管理：音频状态、UI状态、用户选择状态
   - 使用 `useState` 而不是 Context，因为状态都在顶层组件中使用
   - 通过 props 向下传递状态和更新函数，保持数据流清晰

## 性能优化经验

1. **音频生成优化**
   - 实现队列状态监控，避免服务器过载
   - 使用 URL.createObjectURL 处理音频 blob 数据
   - 及时清理不再使用的音频资源和 URL 对象

2. **UI 响应优化**
   - 使用防抖处理频繁的状态更新
   - 实现加载状态指示器
   - 优化错误提示的显示逻辑

## 用户体验改进

1. **语气切换机制**
   - 在切换语气时保留用户输入的脚本
   - 只在使用预设脚本时自动更新脚本内容
   - 添加 RESET 按钮，方便恢复预设内容

2. **错误处理优化**
   - 针对不同错误类型显示不同的提示信息
   - 在 UI 上清晰展示错误状态
   - 提供重试机制

## 代码组织经验

1. **组件拆分原则**
   - 按功能模块拆分组件：Header、Voice、Vibe、Script、Footer
   - 保持组件的单一职责
   - 将共用的类型定义抽离到单独的文件

2. **样式管理**
   - 使用 Tailwind CSS 实现响应式设计
   - 统一的颜色和间距管理
   - 使用 CSS 变量处理主题相关的样式

## 遇到的问题和解决方案

1. **音频播放问题**
   - 问题：切换语音时音频没有正确停止
   - 解决：在切换语音时主动暂停并清理音频实例

2. **状态同步问题**
   - 问题：语气切换时脚本内容更新不同步
   - 解决：优化状态更新逻辑，确保状态变化的顺序正确

3. **类型定义问题**
   - 问题：HTMLAudioElement 类型不支持自定义 dataset
   - 解决：创建 CustomAudioElement 接口扩展原有类型

## 未来改进计划

1. **功能增强**
   - 添加更多语音选项
   - 支持批量生成音频
   - 添加音频编辑功能

2. **性能优化**
   - 实现音频缓存机制
   - 优化大文本处理性能
   - 添加音频预加载功能

3. **用户体验**
   - 添加更多语气预设
   - 优化移动端体验
   - 添加用户偏好设置

## 维护注意事项

1. **代码更新**
   - 确保类型定义及时更新
   - 保持错误处理逻辑一致
   - 维护文档的及时性

2. **性能监控**
   - 定期检查内存使用情况
   - 监控音频生成队列状态
   - 关注用户反馈的性能问题

3. **兼容性维护**
   - 确保在主流浏览器中正常工作
   - 适配不同设备和屏幕尺寸
   - 处理不同网络环境下的异常 